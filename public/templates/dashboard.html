<!-- dashboard.html - Con estilos consistentes -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafePlay - Panel de Control</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      --header-h: 100px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #87CEEB 0%, #ffffff 100%);
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 1rem 0;
      box-shadow: 0 2px 20px rgba(135, 206, 235, 0.3);
      transition: all 0.3s ease;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: #87CEEB;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      border: 2px solid #87CEEB;
    }

    .user-details {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .user-name {
      font-weight: 700;
      color: #2c3e50;
      font-size: 1rem;
    }

    .user-email {
      font-size: 0.85rem;
      color: #7f8c8d;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(45deg, #87CEEB, #4682B4);
      color: white;
      box-shadow: 0 4px 15px rgba(135, 206, 235, 0.4);
    }

    .btn-primary:hover {
      background: linear-gradient(45deg, #4682B4, #87CEEB);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(135, 206, 235, 0.5);
    }

    .btn-danger {
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      color: white;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
    }

    .btn-danger:hover {
      background: linear-gradient(45deg, #c0392b, #e74c3c);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
    }

    .btn-logout {
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      color: white;
      padding: 10px 20px;
      font-size: 0.95rem;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Main Content */
    .main-content {
      padding-top: 120px;
      padding-bottom: 2rem; /* Cambiado de 80px */
      min-height: calc(100vh - 150px); /* Agregado */
    }

    .header-title {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInDown 0.8s ease;
    }

    .header-title h1 {
      font-size: 2.5rem;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .header-title p {
      font-size: 1.1rem;
      color: #5a6c7d;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .card {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(135, 206, 235, 0.2);
      transition: all 0.3s ease;
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
    }

    .card:nth-child(1) { animation-delay: 0.1s; }
    .card:nth-child(2) { animation-delay: 0.2s; }
    .card:nth-child(3) { animation-delay: 0.3s; }
    .card:nth-child(4) { animation-delay: 0.4s; }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(135, 206, 235, 0.3);
    }

    .card h2 {
      color: #4682B4;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .command-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .command-group label {
      font-weight: 600;
      color: #2c3e50;
      font-size: 0.95rem;
    }

    input, select {
      padding: 12px;
      border: 2px solid #87CEEB;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }

    input:focus, select:focus {
      border-color: #4682B4;
      box-shadow: 0 0 10px rgba(135, 206, 235, 0.5);
    }

    input::placeholder {
      color: #95a5a6;
    }

    .button-action {
      padding: 12px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      width: 100%;
    }

    /* Message */
    .message {
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.success {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .message.error {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .message.info {
      background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }

    /* Activity Log */
    .activity-log, .commands-history {
      max-height: 400px;
      overflow-y: auto;
      border: 2px solid #87CEEB;
      border-radius: 10px;
      padding: 1rem;
      background: #f8f9fa;
    }

    .activity-item, .command-item {
      padding: 1rem;
      margin-bottom: 1rem;
      background: white;
      border-left: 4px solid #87CEEB;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .activity-item:hover, .command-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .activity-item.blocked, .command-item.failed {
      border-left-color: #e74c3c;
    }

    .activity-item.started {
      border-left-color: #27ae60;
    }

    .activity-item.timer, .command-item.pending {
      border-left-color: #f39c12;
    }

    .activity-item.closed {
      border-left-color: #95a5a6;
    }

    .command-item.executed {
      border-left-color: #27ae60;
    }

    .activity-action {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .activity-time {
      font-size: 0.85rem;
      color: #7f8c8d;
    }

    /* Stats */
    .stat-card {
      text-align: center;
      padding: 1.5rem;
      background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
      color: white;
      border-radius: 15px;
      margin-bottom: 1rem;
      box-shadow: 0 4px 15px rgba(135, 206, 235, 0.3);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.95rem;
      opacity: 0.9;
    }

    /* Games List */
    .game-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
    }

    .game-badge {
      background: linear-gradient(45deg, #87CEEB, #4682B4);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(135, 206, 235, 0.3);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .no-games {
      color: #95a5a6;
      font-style: italic;
      font-size: 0.95rem;
    }

    /* Full width */
    .full-width {
      grid-column: 1 / -1;
    }

    /* Footer */
    footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 3rem 0;
      margin-top: auto;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
      text-align: left;
    }

    .footer-section {
      padding: 0 1rem;
    }

    .footer-section h4 {
      color: #87CEEB;
      margin-bottom: 1rem;
    }

    .footer-section p {
      color: #95a5a6;
      font-size: 0.9rem;
      line-height: 1.8;
    }

    .footer-section a {
      color: #87CEEB;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: #4682B4;
      text-decoration: underline;
    }

    .footer-bottom {
      border-top: 1px solid #34495e;
      padding-top: 2rem;
      margin-top: 2rem;
      color: #95a5a6;
    }

    /* Responsive */
    @media (max-width: 768px) {

      .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 1rem;
        background: white;
        border-radius: 15px;
        border: 2px solid #87CEEB;
        box-shadow: 0 2px 8px rgba(135, 206, 235, 0.2);
      }

      .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 1.5rem;
      }

      .footer-section {
        padding: 0;
      }

      .user-details {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      .user-name {
        font-weight: 700;
        color: #2c3e50;
        font-size: 1rem;
      }

      .user-email {
        font-size: 0.85rem;
        color: #7f8c8d;
      }

      header {
        padding: 0.8rem 0;
      }

      .logo {
        font-size: 1.3rem;
      }

      .nav-buttons {
        flex-direction: column;
        gap: 0.5rem;
      }

      .header-title h1 {
        font-size: 1.8rem;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      .btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }

      .activity-log, .commands-history {
        max-height: 300px;
      }

    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #87CEEB;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #4682B4;
    }
    /* Estilos para las preguntas frecuentes */
    details summary {
      transition: color 0.3s ease;
    }

    details summary:hover {
      color: #1565c0 !important;
    }

    details[open] summary {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #e3f2fd;
    }

  </style>
</head>
<body>
<header>
  <nav class="container">
    <a href="/" class="logo">SafePlay Control</a>
    <div class="nav-buttons">
      <div class="user-info">
        <div class="user-details">
          <span class="user-name" id="userName">Usuario</span>
          <span class="user-email" id="userEmail">email@ejemplo.com</span>
        </div>
      </div>
      <button class="btn btn-danger" onclick="confirmDeleteAccount()" style="padding: 8px 16px; font-size: 0.85rem;">üóëÔ∏è Eliminar Cuenta</button>
      <button class="btn btn-logout" onclick="logout()">Cerrar sesi√≥n</button>
    </div>
  </nav>
</header>

<div class="main-content">
  <div class="container">
    <div class="header-title">
      <h1>Panel de Control üéÆ</h1>
      <p>Supervisa y controla los juegos remotamente</p>
    </div>

    <!-- PANEL DE INSTRUCCIONES -->
    <div class="card instructions-panel" style="margin-bottom: 2rem;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 style="margin: 0;">üìñ ¬øC√≥mo usar el panel?</h2>
        <button class="btn btn-primary" onclick="toggleInstructions()" id="toggleBtn" style="padding: 8px 16px; font-size: 0.9rem;">
          Ocultar
        </button>
      </div>

      <div id="instructionsContent">
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
          <h3 style="color: #1976d2; margin-bottom: 1rem; font-size: 1.1rem;">üéØ ¬øQu√© es SafePlay?</h3>
          <p style="color: #424242; line-height: 1.8; margin: 0;">
            SafePlay te permite supervisar y controlar el tiempo de juego de otra persona desde cualquier lugar.
            Es ideal para padres que desean establecer l√≠mites saludables en el uso de videojuegos de sus hijos.
          </p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">

          <!-- Instrucci√≥n 1: Bloquear -->
          <div style="background: #fff3e0; padding: 1.5rem; border-radius: 12px; border-left: 4px solid #ff9800;">
            <h4 style="color: #e65100; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 1.5rem;">üö´</span> Bloquear un Juego
            </h4>
            <ol style="color: #5d4037; line-height: 1.8; padding-left: 1.2rem; margin: 0;">
              <li>Escribe el <strong>nombre exacto</strong> del juego (ej: "Minecraft", "Fortnite")</li>
              <li>Haz clic en el bot√≥n <strong>"Bloquear"</strong></li>
              <li>El juego se cerrar√° <strong>inmediatamente</strong> en la computadora</li>
            </ol>
            <div style="background: white; padding: 0.8rem; border-radius: 8px; margin-top: 1rem; font-size: 0.9rem; color: #666;">
              üí° <strong>Tip:</strong> Si no sabes el nombre exacto, revisa la secci√≥n "Juegos Detectados" m√°s abajo.
            </div>
          </div>

          <!-- Instrucci√≥n 2: Timer -->
          <div style="background: #fff9c4; padding: 1.5rem; border-radius: 12px; border-left: 4px solid #fbc02d;">
            <h4 style="color: #f57f17; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 1.5rem;">‚è±Ô∏è</span> Establecer Tiempo L√≠mite
            </h4>
            <ol style="color: #5d4037; line-height: 1.8; padding-left: 1.2rem; margin: 0;">
              <li>Escribe el <strong>nombre del juego</strong></li>
              <li>Indica cu√°ntos <strong>minutos</strong> puede jugar (ej: 60 para 1 hora)</li>
              <li>Haz clic en <strong>"Establecer"</strong></li>
              <li>El juego se cerrar√° autom√°ticamente cuando se acabe el tiempo</li>
            </ol>
            <div style="background: white; padding: 0.8rem; border-radius: 8px; margin-top: 1rem; font-size: 0.9rem; color: #666;">
              üí° <strong>Tip:</strong> Puedes establecer desde 1 minuto hasta 8 horas (480 minutos).
            </div>
          </div>

          <!-- Instrucci√≥n 3: Ver actividad -->
          <div style="background: #e8f5e9; padding: 1.5rem; border-radius: 12px; border-left: 4px solid #4caf50;">
            <h4 style="color: #2e7d32; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 1.5rem;">üìä</span> Monitorear Actividad
            </h4>
            <ul style="color: #1b5e20; line-height: 1.8; padding-left: 1.2rem; margin: 0;">
              <li><strong>Juegos Detectados:</strong> Muestra qu√© juegos est√°n abiertos ahora mismo</li>
              <li><strong>Estado:</strong> Cantidad de comandos pendientes y ejecutados</li>
              <li><strong>Historial de Comandos:</strong> Registra todas las acciones que has realizado</li>
              <li><strong>Actividad en Vivo:</strong> Muestra cuando se abre o cierra un juego</li>
            </ul>
            <div style="background: white; padding: 0.8rem; border-radius: 8px; margin-top: 1rem; font-size: 0.9rem; color: #666;">
              üí° <strong>Tip:</strong> Los datos se actualizan autom√°ticamente cada 10 segundos.
            </div>
          </div>

        </div>

        <!-- Requisitos importantes -->
        <div style="background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem; border: 2px solid #ef5350;">
          <h4 style="color: #c62828; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 1.5rem;">‚ö†Ô∏è</span> Importante - Requisitos
          </h4>
          <div style="color: #b71c1c; line-height: 1.8;">
            <p style="margin: 0 0 0.8rem 0;"><strong>Para que SafePlay funcione correctamente:</strong></p>
            <ol style="padding-left: 1.2rem; margin: 0;">
              <li>La aplicaci√≥n de escritorio <strong>SafePlay debe estar instalada y abierta</strong> en la computadora que deseas supervisar</li>
              <li>La computadora debe tener <strong>conexi√≥n a Internet</strong></li>
              <li>Los nombres de juegos deben escribirse <strong>exactamente</strong> como aparecen en la computadora</li>
            </ol>
            <div style="background: white; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
              <p style="margin: 0; font-size: 0.95rem; color: #666;">
                üì• ¬øA√∫n no tienes la aplicaci√≥n de escritorio?
                <a href="/download" style="color: #1976d2; font-weight: 600; text-decoration: none;">Desc√°rgala aqu√≠</a>
              </p>
            </div>
          </div>
        </div>

        <!-- Preguntas frecuentes -->
        <div style="margin-top: 1.5rem; padding: 1.5rem; background: #f5f5f5; border-radius: 12px;">
          <h4 style="color: #424242; margin-bottom: 1rem;">‚ùì Preguntas Frecuentes</h4>
          <div style="display: grid; gap: 1rem;">

            <details style="background: white; padding: 1rem; border-radius: 8px; cursor: pointer;">
              <summary style="font-weight: 600; color: #1976d2; cursor: pointer;">¬øQu√© pasa si escribo mal el nombre del juego?</summary>
              <p style="margin: 0.8rem 0 0 0; color: #666; line-height: 1.6;">
                Si el nombre no coincide exactamente, el comando no se ejecutar√°. Verifica el nombre en la secci√≥n "Juegos Detectados" o en el historial de actividad.
              </p>
            </details>

            <details style="background: white; padding: 1rem; border-radius: 8px; cursor: pointer;">
              <summary style="font-weight: 600; color: #1976d2; cursor: pointer;">¬øEl usuario puede ver que estoy supervisando?</summary>
              <p style="margin: 0.8rem 0 0 0; color: #666; line-height: 1.6;">
                S√≠, la aplicaci√≥n SafePlay aparece en la barra de tareas. Es importante ser transparente sobre la supervisi√≥n.
              </p>
            </details>

            <details style="background: white; padding: 1rem; border-radius: 8px; cursor: pointer;">
              <summary style="font-weight: 600; color: #1976d2; cursor: pointer;">¬øPuedo recibir reportes por correo?</summary>
              <p style="margin: 0.8rem 0 0 0; color: #666; line-height: 1.6;">
                S√≠, usa el bot√≥n "üìß Enviar por Email" en la secci√≥n de "Actividad en Vivo" para recibir un reporte de las √∫ltimas 24 horas.
              </p>
            </details>

            <details style="background: white; padding: 1rem; border-radius: 8px; cursor: pointer;">
              <summary style="font-weight: 600; color: #1976d2; cursor: pointer;">¬øFunciona con todos los juegos?</summary>
              <p style="margin: 0.8rem 0 0 0; color: #666; line-height: 1.6;">
                SafePlay funciona con la mayor√≠a de juegos de Windows. Algunos juegos con protecci√≥n anti-trampas avanzada podr√≠an no ser detectados correctamente.
              </p>
            </details>

          </div>
        </div>

      </div>
    </div>

    <div id="message" class="message"></div>

    <div class="grid">
      <!-- BLOQUEAR JUEGO -->
      <div class="card">
        <h2>üö´ Bloquear Juego</h2>
        <div class="command-group">
          <label for="blockGame">Nombre del juego:</label>
          <input type="text" id="blockGame" placeholder="ej: Elden Ring">
          <button class="button-action btn-danger" onclick="blockGame()" id="blockBtn">Bloquear</button>
        </div>
        <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 1rem;">
          ‚ö†Ô∏è El juego se cerrar√° inmediatamente
        </p>
      </div>

      <!-- ESTABLECER CRON√ìMETRO -->
      <div class="card">
        <h2>‚è±Ô∏è Tiempo de Juego</h2>
        <div class="command-group">
          <label for="timerGame">Nombre del juego:</label>
          <input type="text" id="timerGame" placeholder="ej: Minecraft">
          <label for="timerMinutes">Minutos permitidos:</label>
          <input type="number" id="timerMinutes" min="1" max="480" value="60">
          <button class="button-action btn-primary" onclick="setTimer()" id="timerBtn">Establecer</button>
        </div>
        <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 1rem;">
          ‚è∞ Se cerrar√° autom√°ticamente
        </p>
      </div>

      <!-- JUEGOS ACTIVOS -->
      <div class="card">
        <h2>üéÆ Juegos Detectados</h2>
        <div class="game-list" id="gamesList">
          <p class="no-games">Sin juegos activos</p>
        </div>
        <button class="button-action btn-primary" onclick="refreshGames()" style="margin-top: 1rem;">
          Actualizar
        </button>
      </div>

      <!-- ESTAD√çSTICAS -->
      <div class="card">
        <h2>üìä Estado</h2>
        <div class="stat-card">
          <div class="stat-number" id="statsComandos">0</div>
          <div class="stat-label">Pendientes</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statsEjecutados">0</div>
          <div class="stat-label">Ejecutados</div>
        </div>
        <button class="button-action btn-primary" onclick="refreshStatus()" style="margin-top: 1rem;">
          Actualizar
        </button>
      </div>

      <!-- HISTORIAL DE COMANDOS -->
      <div class="card full-width">
        <h2>üìú Historial de Comandos</h2>
        <div class="commands-history" id="commandsHistory">
          <p style="color: #95a5a6; text-align: center;">Cargando...</p>
        </div>
      </div>

      <!-- ACTIVIDAD EN VIVO -->
      <div class="card full-width">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 style="margin: 0;">üìπ Actividad en Vivo</h2>
          <button class="btn btn-primary" onclick="sendActivityEmail()" id="emailBtn" style="padding: 8px 16px; font-size: 0.9rem;">
            üìß Enviar por Email
          </button>
        </div>
        <div class="activity-log" id="activityLog">
          <p style="color: #95a5a6; text-align: center;">Sin actividad</p>
        </div>
      </div>
    </div> <!-- Cierre del √∫ltimo card -->
  </div> <!-- Cierre del grid -->
</div> <!-- Cierre del container -->

<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h4>SafePlay</h4>
        <p>Control remoto de juegos para supervisores responsables.</p>
      </div>
      <div class="footer-section">
        <h4>Enlaces R√°pidos</h4>
        <p>
          <a href="/" style="color:#87CEEB; text-decoration:none;">Inicio</a> ‚Ä¢
          <a href="/register" style="color:#87CEEB; text-decoration:none;">Registro</a> ‚Ä¢
          <a href="/download" style="color:#87CEEB; text-decoration:none;">Descarga</a>
        </p>
      </div>
      <div class="footer-section">
        <h4>Contacto</h4>
        <p>soportesafeplay@gmail.com<br>+57 - 3224687627</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 SafePlay. Todos los derechos reservados.</p>
    </div>
  </div>
</footer>

<script>

  /**
   * Confirma y elimina la cuenta del usuario
   */
  async function confirmDeleteAccount() {
    const confirmed = confirm(
            '‚ö†Ô∏è ADVERTENCIA: Esta acci√≥n es IRREVERSIBLE\n\n' +
            '¬øEst√°s seguro de que deseas eliminar tu cuenta?\n\n' +
            '‚Ä¢ Se eliminar√°n todos tus datos permanentemente\n' +
            '‚Ä¢ Se eliminar√°n todos los comandos y actividad\n' +
            '‚Ä¢ No podr√°s recuperar esta informaci√≥n\n' +
            '‚Ä¢ Tu correo quedar√° disponible para un nuevo registro\n\n' +
            'Presiona OK para continuar o Cancelar para volver.'
    );

    if (!confirmed) return;

    // Segunda confirmaci√≥n con texto
    const confirmText = prompt(
            'Por seguridad, escribe "ELIMINAR" (en may√∫sculas) para confirmar la eliminaci√≥n permanente de tu cuenta:'
    );

    if (confirmText !== 'ELIMINAR') {
      showMessage('‚ùå Eliminaci√≥n cancelada. Tu cuenta no ha sido modificada.', 'info');
      return;
    }

    // Opcional: pedir contrase√±a para mayor seguridad
    const password = prompt('Por favor, ingresa tu contrase√±a para confirmar:');
    if (!password) {
      showMessage('‚ùå Eliminaci√≥n cancelada', 'info');
      return;
    }

    try {
      const token = localStorage.getItem('token');
      const res = await fetch('/api/auth/delete-account', {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ password }) // Enviar contrase√±a para validaci√≥n
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.error || 'Error al eliminar cuenta');
      }

      // Limpiar token
      localStorage.removeItem('token');

      // Mostrar mensaje final
      alert('‚úÖ Tu cuenta ha sido eliminada permanentemente.\n\nGracias por usar SafePlay.');

      // Redirigir a la p√°gina principal
      location.href = '/';

    } catch (error) {
      console.error('Error:', error);
      showMessage(`‚ùå Error: ${error.message}`, 'error');
    }
  }


  async function loadUserInfo() {
    try {
      const token = localStorage.getItem('token');
      if (!token) {
        location.href = '/login.html';
        return;
      }

      // Llamar al endpoint /api/me para obtener datos completos
      const res = await fetch('/api/me', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      const data = await res.json();

      if (!res.ok || data.error) {
        localStorage.removeItem('token');
        location.href = '/login.html';
        return;
      }

      // Actualizar la interfaz con los datos reales
      document.getElementById('userName').textContent = data.fullName || data.username || 'Usuario';
      document.getElementById('userEmail').textContent = data.email || 'email@ejemplo.com';

    } catch (error) {
      console.error('Error cargando usuario:', error);
      // Si falla, intentar decodificar el token como fallback
      try {
        const token = localStorage.getItem('token');
        const payload = JSON.parse(atob(token.split('.')[1]));
        document.getElementById('userName').textContent = payload.username || 'Usuario';
        document.getElementById('userEmail').textContent = 'Cargando...';
      } catch {
        document.getElementById('userName').textContent = 'Usuario';
        document.getElementById('userEmail').textContent = 'email@ejemplo.com';
      }
    }
  }

  async function sendActivityEmail() {
    // Mostrar mensaje de confirmaci√≥n
    const confirmed = confirm(
            'üìß ¬øDeseas enviar el historial de actividad de las √∫ltimas 24 horas por correo?\n\n' +
            'Se enviar√° un reporte detallado a tu email registrado.'
    );

    // Si el usuario cancela, no hacer nada
    if (!confirmed) {
      return;
    }

    const btn = document.getElementById('emailBtn');
    btn.disabled = true;
    btn.textContent = 'üìß Enviando...';

    try {
      const data = await apiCall('POST', '/activity/send-email');
      showMessage(`‚úÖ Historial enviado exitosamente (${data.count} registros)`, 'success');
    } catch (error) {
      showMessage(`‚ùå Error al enviar: ${error.message}`, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'üìß Enviar por Email';
    }
  }

  const API_BASE = '/api/electron';
  let token = localStorage.getItem('token');

  if (!token) {
    location.href = '/login.html';
  }

  function showMessage(text, type = 'success') {
    const msg = document.getElementById('message');
    msg.textContent = text;
    msg.className = `message ${type}`;
    setTimeout(() => {
      msg.className = 'message';
    }, 5000);
  }

  function getHeaders() {
    return {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    };
  }

  async function apiCall(method, endpoint, body = null) {
    try {
      const opts = { method, headers: getHeaders() };
      if (body) opts.body = JSON.stringify(body);

      const res = await fetch(`${API_BASE}${endpoint}`, opts);
      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        throw new Error(data.error || `Error HTTP ${res.status}`);
      }
      return data;
    } catch (error) {
      console.error('API Error:', error);
      throw error;
    }
  }

  async function blockGame() {
    const gameName = document.getElementById('blockGame').value.trim();
    if (!gameName) {
      showMessage('Ingresa el nombre del juego', 'error');
      return;
    }

    const btn = document.getElementById('blockBtn');
    btn.disabled = true;

    try {
      await apiCall('POST', '/commands', { action: 'block', target: gameName });
      showMessage(`‚úÖ ${gameName} ser√° bloqueado`);
      document.getElementById('blockGame').value = '';
      loadCommandsHistory();
    } catch (error) {
      showMessage(`‚ùå ${error.message}`, 'error');
    } finally {
      btn.disabled = false;
    }
  }

  async function setTimer() {
    const gameName = document.getElementById('timerGame').value.trim();
    const minutes = parseInt(document.getElementById('timerMinutes').value);

    if (!gameName || !minutes || minutes < 1) {
      showMessage('Completa todos los campos', 'error');
      return;
    }

    const btn = document.getElementById('timerBtn');
    btn.disabled = true;

    try {
      await apiCall('POST', '/commands', { action: 'set_timer', target: gameName, duration: minutes });
      showMessage(`‚úÖ Timer: ${minutes}min para ${gameName}`);
      document.getElementById('timerGame').value = '';
      loadCommandsHistory();
    } catch (error) {
      showMessage(`‚ùå ${error.message}`, 'error');
    } finally {
      btn.disabled = false;
    }
  }

  async function refreshGames() {
    try {
      const data = await apiCall('GET', '/activity?limit=100');
      const games = new Map();

      if (data.logs) {
        data.logs.forEach(log => {
          if (log.action === 'started' || log.action === 'timer_set') {
            games.set(log.gameName, true);
          }
        });
      }

      const gamesList = document.getElementById('gamesList');
      gamesList.innerHTML = games.size === 0
              ? '<p class="no-games">Sin juegos activos</p>'
              : Array.from(games.keys()).map(name => `<div class="game-badge">${name}</div>`).join('');
    } catch (error) {
      console.error('Error:', error);
    }
  }

  async function refreshStatus() {
    try {
      const data = await apiCall('GET', '/commands/history?limit=100');
      document.getElementById('statsComandos').textContent = data.commands.filter(c => c.status === 'pending').length;
      document.getElementById('statsEjecutados').textContent = data.commands.filter(c => c.status === 'executed').length;
      showMessage('‚úÖ Estado actualizado', 'info');
    } catch (error) {
      showMessage(`‚ùå ${error.message}`, 'error');
    }
  }

  async function loadCommandsHistory() {
    try {
      const data = await apiCall('GET', '/commands/history?limit=20');
      const container = document.getElementById('commandsHistory');

      if (!data.commands?.length) {
        container.innerHTML = '<p style="color: #95a5a6; text-align: center;">Sin comandos</p>';
        return;
      }

      container.innerHTML = data.commands.map(cmd => {
        const date = new Date(cmd.createdAt);
        const timeStr = date.toLocaleTimeString('es-ES');
        const actionText = { block: 'Bloquear', set_timer: 'Timer' }[cmd.action] || cmd.action;

        return `
          <div class="command-item ${cmd.status}">
            <div class="activity-action">${actionText} - ${cmd.target || 'N/A'}</div>
            <div style="color: #7f8c8d; font-size: 0.9rem;">${cmd.duration ? `${cmd.duration} min` : ''}</div>
            <div class="activity-time">${timeStr} ‚Ä¢ ${cmd.status}</div>
          </div>
        `;
      }).join('');

      document.getElementById('statsComandos').textContent = data.commands.filter(c => c.status === 'pending').length;
    } catch (error) {
      console.error('Error:', error);
    }
  }

  async function loadActivity() {
    try {
      const data = await apiCall('GET', '/activity?limit=30');
      const container = document.getElementById('activityLog');

      if (!data.logs?.length) {
        container.innerHTML = '<p style="color: #95a5a6; text-align: center;">Sin actividad</p>';
        return;
      }

      container.innerHTML = data.logs.map(log => {
        const date = new Date(log.createdAt);
        const timeStr = date.toLocaleTimeString('es-ES');
        const actionMap = { blocked: 'üö´ Bloqueado', started: '‚ñ∂Ô∏è Iniciado', timer_set: '‚è±Ô∏è Timer', closed: '‚èπÔ∏è Cerrado' };

        return `
          <div class="activity-item ${log.action}">
            <div class="activity-action">${actionMap[log.action] || log.action}: ${log.gameName}</div>
            <div class="activity-time">${timeStr}</div>
          </div>
        `;
      }).join('');
    } catch (error) {
      console.error('Error:', error);
    }
  }

  function logout() {
    localStorage.removeItem('token');
    location.href = '/login.html';
  }

  // Funci√≥n para mostrar/ocultar instrucciones
  function toggleInstructions() {
    const content = document.getElementById('instructionsContent');
    const btn = document.getElementById('toggleBtn');

    if (content.style.display === 'none') {
      content.style.display = 'block';
      btn.textContent = 'Ocultar';
      localStorage.setItem('instructionsVisible', 'true');
    } else {
      content.style.display = 'none';
      btn.textContent = 'Mostrar';
      localStorage.setItem('instructionsVisible', 'false');
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadUserInfo(); // ‚Üê Aseg√∫rate de tener esta l√≠nea
    loadCommandsHistory();
    loadActivity();
    refreshGames();
    refreshStatus();

    setInterval(() => {
      loadCommandsHistory();
      loadActivity();
      refreshGames();
    }, 10000);
  });
</script>
</body>
</html>